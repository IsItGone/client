<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IsItGone Map</title>
    <style>
      body {
        margin: 0;
      }
    </style>
    <script>
      function getQueryParams() {
        const params = {};
        window.location.search
          .substring(1)
          .split("&")
          .forEach((pair) => {
            const [key, value] = pair.split("=");
            params[decodeURIComponent(key)] = decodeURIComponent(value);
          });
        return params;
      }

      const params = getQueryParams();
      const clientId = params["clientId"];
      document.write(`
      <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=${clientId}&callback=initMap"><\/script>
    `);
    </script>
  </head>
  <body>
    <div id="map" style="width: 100%; height: 80vh"></div>
    <script id="code">
      console.log(clientId);
      var map = new naver.maps.Map("map", {
        center: new naver.maps.LatLng(36.3553177, 127.2981911), // 대전 삼성화재 연수원
        mapTypeId: naver.maps.MapTypeId.NORMAL,
      });

      var infowindow = new naver.maps.InfoWindow();

      function onSuccessGeolocation(position) {
        var location = new naver.maps.LatLng(position.coords.latitude, position.coords.longitude);

        map.setCenter(location); // 얻은 좌표를 지도의 중심으로 설정합니다.

        infowindow.setContent(
          '<div style="padding:20px;">' + "geolocation.getCurrentPosition() 위치" + "</div>"
        );

        infowindow.open(map, location);
        console.log("Coordinates: " + location.toString());
      }

      function onErrorGeolocation() {
        var center = map.getCenter();

        infowindow.setContent(
          '<div style="padding:20px;">' +
            '<h5 style="margin-bottom:5px;color:#f00;">Geolocation failed!</h5>' +
            "latitude: " +
            center.lat() +
            "<br />longitude: " +
            center.lng() +
            "</div>"
        );

        infowindow.open(map, center);
      }

      window.addEventListener("load", function () {
        console.log(navigator.geolocation);
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(onSuccessGeolocation, onErrorGeolocation);
        } else {
          var center = map.getCenter();
          infowindow.setContent(
            '<div style="padding:20px;"><h5 style="margin-bottom:5px;color:#f00;">Geolocation not supported</h5></div>'
          );
          infowindow.open(map, center);
        }
      });
    </script>
  </body>
</html>
